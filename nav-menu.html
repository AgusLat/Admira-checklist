<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Menú principal</title>
    <link rel="stylesheet" href="styles/nav-menu.css" />
  </head>

  <body>
    <main>
      <div class="contenido">
        <h1>CHECKLIST OFICINA</h1>
        <nav class="navMenu" id="menu"></nav>
      </div>
    </main>

    <script type="module">
      import { firebaseConfig } from "./firebase/firebaseConfig.js";
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
      import {
        getAuth,
        onAuthStateChanged,
        signOut,
      } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
      import {
        slidesSantaRosa,
        slidesStore,
        slidesPlanetaTerminator,
        slidesPlanetaNave,
      } from "./slides/slides.js";

      // --- 1. Configuración Firebase (misma que index) ---

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      // --- 2. Verificar sesión ---
      onAuthStateChanged(auth, (user) => {
        if (!user) {
          window.location.href = "index.html";
          return;
        }

        // --- 3. Construir menú según parámetro ---
        const oficina =
          new URLSearchParams(window.location.search).get("oficina") ||
          "general";
        const menu = document.getElementById("menu");
        let opciones = [];

        switch (oficina) {
          case "santa-rosa":
            opciones = Object.keys(slidesSantaRosa).map((titulo) => ({
              seccion: titulo.toLocaleUpperCase(),
              href: `slides.html?oficina=${oficina}&seccion=${titulo}`,
            }));
            break;
          case "store":
            opciones = Object.keys(slidesStore).map((titulo) => ({
              seccion: titulo.toLocaleUpperCase(),
              href: `slides.html?oficina=${oficina}&seccion=${titulo}`,
            }));
            break;
          case "planeta-terminator":
            opciones = Object.keys(slidesPlanetaTerminator).map((titulo) => ({
              seccion: titulo.toLocaleUpperCase(),
              href: `slides.html?oficina=${oficina}&seccion=${titulo}`,
            }));
            break;
          case "planeta-nave":
            opciones = Object.keys(slidesPlanetaNave).map((titulo) => ({
              seccion: titulo.toLocaleUpperCase(),
              href: `slides.html?oficina=${oficina}&seccion=${titulo}`,
            }));
            break;
          default:
            opciones = [{ seccion: "OFICINA NO IDENTIFICADA", href: "" }];
            break;
        }

        // Render del menú
        menu.innerHTML = `
      <ul>
        ${opciones
          .map((opt) => `<li><a href="${opt.href}">${opt.seccion}</a></li>`)
          .join("")}
      </ul>
      <a class="logoutBtn" href="#logout">Cerrar sesión</a>
    `;

        // --- 4. Logout ---
        document
          .querySelector('a[href="#logout"]')
          .addEventListener("click", async () => {
            await signOut(auth);
            localStorage.clear();
            window.location.href = "index.html";
          });
      });
    </script>
  </body>
</html>
