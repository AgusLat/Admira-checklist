<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Checklist</title>
    <link rel="stylesheet" href="styles/style.css" />
  </head>
  <body>
    <div id="slides"></div>

    <div id="issueModal">
      <div id="issueContent">
        <h3>âš  Reportar incidencia</h3>
        <p id="issueStep"></p>
        <textarea
          id="issueDesc"
          placeholder="Describe el problema..."
          rows="4"
        ></textarea>
        <input type="file" id="issueFile" accept="image/*" />
        <div style="text-align: center">
          <button id="cancelIssueBtn">Cancelar</button>
          <button id="sendIssueBtn">Enviar</button>
        </div>
      </div>
    </div>

    <script type="module">
      import { renderSlides, currentSlideIndex, slides } from "./js/slides-control.js";
      import { reportIssue } from "./js/incidencias.js";
      import {openIssueModal, closeIssueModal} from "./js/modal.js"
      import {
        slidesSantaRosa,
        slidesPlanetaNave,
        slidesPlanetaTerminator,
        slidesStore,
      } from "./slides/slides.js";

      //PARAMS
      const oficina = new URLSearchParams(window.location.search).get(
        "oficina"
      );
      const seccion = new URLSearchParams(window.location.search).get(
        "seccion"
      );


      // const oficinaKey = oficina.replace(/-/g, "").toLowerCase();

      const sitios = {
        santarosa: slidesSantaRosa,
        planetanave: slidesPlanetaNave,
        planetaterminator: slidesPlanetaTerminator,
        store: slidesStore,
      };

      //ELEMENTOS
      const slidesArray = Object.values(sitios[oficina][seccion]);      
      const container = document.getElementById("slides");
      const cancelIssueBtn = document.getElementById("cancelIssueBtn");
      const sendIssueBtn = document.getElementById("sendIssueBtn");




      //EVENTOS

      cancelIssueBtn.addEventListener("click", ()=>{
      document.getElementById("issueModal").style.display = "none";
      document.getElementById("issueDesc").value = "";
      document.getElementById("issueFile").value = "";
      })

      sendIssueBtn.addEventListener("click",  () => {
        const issueDesc = document.getElementById("issueDesc").value.trim();
        const issue = {
          oficina: oficina,
          seccion: seccion,
          incidencia: issueDesc,
          paso: currentSlideIndex,
          pasoDesc: slides[currentSlideIndex].desc,
        };
        reportIssue(issue);
        closeIssueModal();} 
    )


      //RENDERIZA LAS SLIDES
      renderSlides(container, slidesArray);
    </script>
  </body>
</html>
